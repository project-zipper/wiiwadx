<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Wiiwadx</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="top-bar">
    <h1>Wiiwadx</h1>
</div>

<div class="channel-grid" id="channelGrid">
    <p class="loading">Loading WADs...</p>
</div>

<script>
const username = "project-zipper";
const repo = "wiiwadx";
const branch = "main";
const baseFolder = "wads";

const channelGrid = document.getElementById("channelGrid");

// Fetch folder contents
async function fetchFolder(path) {
    const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/${path}`;
    const response = await fetch(apiUrl);
    return response.json();
}

// Recursively search folders
async function loadWads(path) {
    const items = await fetchFolder(path);

    if (!Array.isArray(items)) return;

    for (const item of items) {
        if (item.type === "file" && item.name.toLowerCase().endsWith(".wad")) {
            addChannel(item.path, item.name);
        }

        if (item.type === "dir") {
            await loadWads(item.path); // Recursive call
        }
    }
}

// Create Wii-style channel
function addChannel(filePath, fileName) {
    const downloadUrl = `https://raw.githubusercontent.com/${username}/${repo}/${branch}/${filePath}`;

    const channel = document.createElement("div");
    channel.className = "channel";

    channel.innerHTML = `
        <div class="channel-inner">
            <span class="icon">ðŸŽ®</span>
            <p>${fileName}</p>
        </div>
    `;

    channel.addEventListener("click", () => {
        const a = document.createElement("a");
        a.href = downloadUrl;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    });

    channelGrid.appendChild(channel);
}

// Start loading
channelGrid.innerHTML = "";
loadWads(baseFolder).then(() => {
    if (channelGrid.innerHTML === "") {
        channelGrid.innerHTML = "<p class='no-files'>No .wad files found.</p>";
    }
}).catch(() => {
    channelGrid.innerHTML = "<p class='no-files'>Error loading wads folder.</p>";
});
</script>

</body>
</html>
